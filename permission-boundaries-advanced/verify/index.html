


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A hands-on workshop to learn about a variety of AWS identity topics.">
      
      
        <link rel="canonical" href="https://identity-round-robin.awssecworkshops.com/permission-boundaries-advanced/verify/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      <link rel="shortcut icon" href="../../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>Verify Phase - Identity Round Robin</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.a2408e81.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#permission-boundaries-workshop-verify-phase" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://identity-round-robin.awssecworkshops.com/" title="Identity Round Robin" class="md-header-nav__button md-logo" aria-label="Identity Round Robin">
      
  <img src="../../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Identity Round Robin
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Verify Phase
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        Overview
      </a>
    
  </li>

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../serverless/" class="md-tabs__link">
          Serverless Identity
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../delegation/" class="md-tabs__link">
          Access Delegation
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          Permissions Boundaries - Advanced
        </a>
      
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://identity-round-robin.awssecworkshops.com/" title="Identity Round Robin" class="md-nav__button md-logo" aria-label="Identity Round Robin">
      
  <img src="../../assets/images/aws_smile_logo.png" alt="logo">

    </a>
    Identity Round Robin
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-identity-round-robin-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Serverless Identity
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Serverless Identity" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Serverless Identity
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task1/" title="Task 1" class="md-nav__link">
      Task 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../serverless/task2/" title="Task 2" class="md-nav__link">
      Task 2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Access Delegation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Access Delegation" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Access Delegation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/build/" title="Build Phase" class="md-nav__link">
      Build Phase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../delegation/verify/" title="Verify Phase" class="md-nav__link">
      Verify Phase
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Permissions Boundaries - Advanced
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Permissions Boundaries - Advanced" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Permissions Boundaries - Advanced
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Scenario" class="md-nav__link">
      Scenario
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../build/" title="Build Phase" class="md-nav__link">
      Build Phase
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Verify Phase
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Verify Phase" class="md-nav__link md-nav__link--active">
      Verify Phase
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-create-a-policy" class="md-nav__link">
    Task 1 Create a policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-create-a-role" class="md-nav__link">
    Task 2 Create a role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-create-and-test-a-lambda-function" class="md-nav__link">
    Task 3 Create and test a Lambda function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-4-cleanup" class="md-nav__link">
    Task 4 Cleanup
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-create-a-policy" class="md-nav__link">
    Task 1 Create a policy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-create-a-role" class="md-nav__link">
    Task 2 Create a role
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-3-create-and-test-a-lambda-function" class="md-nav__link">
    Task 3 Create and test a Lambda function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-4-cleanup" class="md-nav__link">
    Task 4 Cleanup
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-identity-round-robin-workshop/edit/master/docs/permission-boundaries-advanced/verify.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="permission-boundaries-workshop-verify-phase">Permission boundaries workshop <small> Verify phase</small></h1>
<p>It's now time <strong>VERIFY</strong> the setup from the <strong>Build</strong> phase. You will be acting as the webadmins in this phase to check that you can do the following: </p>
<ol>
<li>Create an IAM policy</li>
<li>Create an IAM role (and attach that policy) </li>
<li>Create a Lambda function (and attach that role)</li>
</ol>
<div class="admonition pre-verification">
<p class="admonition-title">Pre-verification</p>
<p><p style="font-size:14px;">
  In order validate your setup <strong><em>before</em></strong> swapping credentials with another team, enter the <strong><em>account Id for your team</em></strong> instead of the other team in the <code>~/.aws/config</code> file referenced above for the <em>role_arn</em> and proceed with the steps below. The VERIFY phase assumes you are checking another team's setup but for your own testing this will be just done in your own account. You'll need to keep that in mind because some of the VERIFY phase instructions assume you are doing this cross account so you'll need to adjust some of the commands. Once you have confirmed the delegated access is functioning within your team account, update <code>~/.aws/config</code> and test against the other team's account.
</p></p>
</div>
<p>1. Verify in <strong>your</strong> team's account:</p>
<ul>
<li>To carry out the tasks below as the webadmins in <strong>your team's</strong> account, you will need to assume that role. To make that process easier, add the following to the <code>~/.aws/config</code> file:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">[profile webadmins]</span>
<span class="na">role_arn</span> <span class="o">=</span> <span class="s">arn:aws:iam::YOUR_TEAMS_ACCOUNT_ID:role/webadmins</span>
<span class="na">source_profile</span> <span class="o">=</span> <span class="s">default</span>
</code></pre></div>


<p>2. Verify in <strong>other</strong> team's account:</p>
<ul>
<li>To carry out the tasks below as the webadmins in the <strong>other team's</strong> account, you will need to assume that role. To make that process easier, add the following to the <code>~/.aws/config</code> file:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="k">[profile webadmins]</span>
<span class="na">role_arn</span> <span class="o">=</span> <span class="s">arn:aws:iam::ACCOUNT_ID_FROM_OTHER_TEAM:role/webadmins</span>
<span class="na">source_profile</span> <span class="o">=</span> <span class="s">default</span>
</code></pre></div>


<p>If doing this as part of an AWS event you should have received the following information from another team. You will need the <strong>Account ID</strong> and the <strong>Resource restriction</strong> information to complete the tasks in this phase.</p>
<div class="codehilite"><pre><span></span><code><span class="n">Webadmins</span> <span class="n">role</span> <span class="n">ARN</span><span class="p">:</span> <span class="n">arn</span><span class="p">:</span><span class="n">aws</span><span class="p">:</span><span class="n">iam</span><span class="p">::</span><span class="ss">`ACCOUNT_ID_FROM_OTHER_TEAM`</span><span class="p">:</span><span class="n">role</span><span class="cm">/**webadmins**</span>
<span class="cm">Resource restriction for both the roles and policies: /webadmins/`Resource restriction`</span>
<span class="cm">Permissions boundary name: **webadminspermissionsboundary**</span>
<span class="cm">Permission policy name: **webadminspermissionpolicy**</span>
</code></pre></div>


<p><strong>When using the AWS CLI and you want to reference a profile other then the default one you need to add the <code>--profile</code> parameter to the CLI command. Since we are naming this profile webadmins, you will see that <code>--profile webadmins</code> has been added to all the commands in this phase.</strong></p>
<details class="info"><summary>Application architecture</summary><p><img alt="image1" src="../images/architecture.png" /></p>
</details>
<hr />
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p><p style="font-size:16px;">
  Please keep in mind where to add the AWS Account ID, correctly use pathing and change the region specified if needed (although if you are taking this as part of an AWS event, just use the already specified us-east-1.)
</p></p>
</div>
<h2 id="task-1-create-a-policy">Task 1 <small>Create a policy</small></h2>
<p>First you will create a permission policy which just needs to allow log file creation and s3:ListBucket. You are in a hurry though, like many developers, and give the role full S3 permissions. The policy you create here will later be attached to the role you create in Task 2 which will then be passed to a Lambda function you will create in <strong>Task 3</strong>.</p>
<ul>
<li>Use the following JSON to create a file named <strong><code>verifypolicy.json</code></strong>: </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
      <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;logs:CreateLogGroup&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logs:CreateLogStream&quot;</span><span class="p">,</span>
        <span class="s2">&quot;logs:PutLogEvents&quot;</span><span class="p">,</span>
        <span class="s2">&quot;s3:*&quot;</span>
      <span class="p">],</span>
      <span class="nt">&quot;Resource&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>Create the policy (<strong>there is a key parameter missing from the command below. Check the <a href="https://docs.aws.amazon.com/cli/latest/reference/" target="_blank"> AWS CLI documentation to determine the missing parameter. </a> </strong>)</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam create-policy --policy-name NAME_OF_POLICY --policy-document file://verifypolicy.json --profile webadmins</span>
</code></pre></div>


<!-- `aws iam create-policy --policy-name NAME_OF_POLICY --path /webadmins/ --policy-document file://verifypolicy.json` -->

<details class="info"><summary>Stuck?</summary><p>This section can be challenging so you are having continued trouble you <strong>may</strong> wish to review the  <a href="../artifacts/pbw-solution-notes.pdf" target="_blank">sample solution commands in the helper doc.</a></p>
</details>
<h2 id="task-2-create-a-role">Task 2 <small>Create a role</small></h2>
<p>The role you create here will be passed to the Lambda function you create in the next task.</p>
<ul>
<li>Use the following JSON to create a file named <strong><code>verifytrustpolicy.json</code></strong>: </li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;Version&quot;</span><span class="p">:</span> <span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
  <span class="nt">&quot;Statement&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;Effect&quot;</span><span class="p">:</span> <span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
    <span class="nt">&quot;Principal&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;Service&quot;</span><span class="p">:</span> <span class="s2">&quot;lambda.amazonaws.com&quot;</span>
    <span class="p">},</span>
    <span class="nt">&quot;Action&quot;</span><span class="p">:</span> <span class="s2">&quot;sts:AssumeRole&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<ul>
<li>Create the role (<strong>there is a key parameter missing from the command below. Check the <a href="https://docs.aws.amazon.com/cli/latest/reference/" target="_blank"> AWS CLI documentation to determine the missing parameter. </a> </strong>)</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam create-role --role-name NAME_OF_ROLE --path /webadmins/ --assume-role-policy-document file://verifytrustpolicy.json --profile webadmins</span>
</code></pre></div>


<!-- `aws iam create-role --role-name NAME_OF_ROLE --path /NAME_OF_PATH/ --assume-role-policy-document file://verifytrustpolicy.json --permissions-boundary arn:aws:iam::ACCOUNT_ID_FROM_OTHER_TEAM:policy/webadminspermissionsboundary` -->

<ul>
<li>Attach the policy you created in <strong>Task 1</strong> to the role:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam attach-role-policy --policy-arn arn:aws:iam::&lt;ACCOUNT_ID_FROM_OTHER_TEAM&gt;:policy/webadmins/NAME_OF_POLICY --role-name NAME_OF_ROLE --profile webadmins</span>
</code></pre></div>


<h2 id="task-3-create-and-test-a-lambda-function">Task 3 <small>Create and test a Lambda function</small></h2>
<p>Finally, you will create a <strong>Node.js 8.10</strong> Lambda function using the sample code below and pass the IAM role you just created:</p>
<ul>
<li>Create a file named <strong><code>index.js</code></strong> using the code below. Replace <code>"SHARED_LOGGING_BUCKET_NAME"</code> with the name of bucket that begins with <code>"shared-logging-"</code> and ends in <code>"-data"</code>. Also replace <code>"PREFIX_FROM_PERMISSIONS_BOUNDARY"</code> with the prefix the permissions boundary requires for that bucket.  In order to find the bucket name, just run <code>aws s3 ls --profile webadmins</code>. In order to find the prefix, examine the permissions boundary policy from the <strong>BUILD</strong> phase. </li>
</ul>
<details class="info"><summary>What is an S3 prefix?</summary><p><p style="font-size:16px;">
  In Amazon S3, buckets and objects are the primary resources, and objects are stored in buckets. Amazon S3 has a flat structure instead of a hierarchy like you would see in a file system. However, for the sake of organizational simplicity, the Amazon S3 console supports the folder concept as a means of grouping objects. Amazon S3 does this by using a <strong>shared name prefix</strong> for objects (that is, objects that have names that begin with a common string). Object names are also referred to as key names. For example, you can create a folder on the console named photos and store an object named myphoto.jpg in it. The object is then stored with the key name photos/myphoto.jpg, where photos/ is the prefix.
</p></p>
</details>
<div class="codehilite"><pre><span></span><code><span class="nt">const</span> <span class="nt">AWS</span> <span class="o">=</span> <span class="nt">require</span><span class="o">(</span><span class="s1">&#39;aws-sdk&#39;</span><span class="o">);</span>
<span class="nt">const</span> <span class="nt">s3</span> <span class="o">=</span> <span class="nt">new</span> <span class="nt">AWS</span><span class="p">.</span><span class="nc">S3</span><span class="o">();</span>

<span class="nt">exports</span><span class="p">.</span><span class="nc">handler</span> <span class="o">=</span> <span class="nt">async</span> <span class="o">(</span><span class="nt">event</span><span class="o">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="err">console.log(&#39;Loading</span> <span class="err">function&#39;)</span><span class="p">;</span>
  <span class="err">const</span> <span class="err">allKeys</span> <span class="err">=</span> <span class="cp">[]</span><span class="p">;</span>
  <span class="err">await</span> <span class="err">getKeys({</span> <span class="n">Bucket</span><span class="p">:</span> <span class="s1">&#39;SHARED_LOGGING_BUCKET_NAME&#39;</span> <span class="p">,</span> <span class="n">Prefix</span><span class="o">:</span> <span class="s1">&#39;PREFIX_FROM_PERMISSIONS_BOUNDARY&#39;</span><span class="p">}</span><span class="o">,</span> <span class="nt">allKeys</span><span class="o">);</span>
  <span class="nt">return</span> <span class="nt">allKeys</span><span class="o">;</span>
<span class="err">}</span><span class="o">;</span>

<span class="nt">async</span> <span class="nt">function</span> <span class="nt">getKeys</span><span class="o">(</span><span class="nt">params</span><span class="o">,</span> <span class="nt">keys</span><span class="o">)</span><span class="p">{</span>
  <span class="err">const</span> <span class="err">response</span> <span class="err">=</span> <span class="err">await</span> <span class="err">s3.listObjectsV2(params).promise()</span><span class="p">;</span>
  <span class="err">response.Contents.forEach(obj</span> <span class="err">=&gt;</span> <span class="err">keys.push(obj.Key))</span><span class="p">;</span>

  <span class="err">if</span> <span class="err">(response.IsTruncated)</span> <span class="err">{</span>
    <span class="err">const</span> <span class="err">newParams</span> <span class="err">=</span> <span class="err">Object.assign({</span><span class="p">}</span><span class="o">,</span> <span class="nt">params</span><span class="o">);</span>
    <span class="nt">newParams</span><span class="p">.</span><span class="nc">ContinuationToken</span> <span class="o">=</span> <span class="nt">response</span><span class="p">.</span><span class="nc">NextContinuationToken</span><span class="o">;</span>
    <span class="nt">await</span> <span class="nt">getKeys</span><span class="o">(</span><span class="nt">newParams</span><span class="o">,</span> <span class="nt">keys</span><span class="o">);</span> 
  <span class="err">}</span>
<span class="err">}</span>
</code></pre></div>


<ul>
<li>Zip the index.js file for upload to Lambda</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">zip lambdafunction.zip index.js</span>
</code></pre></div>


<ul>
<li>Create a Lambda function</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws lambda create-function --function-name verifyfunction --runtime nodejs10.x --role arn:aws:iam::&lt;ACCOUNT_ID_FROM_OTHER_TEAM&gt;:role/webadmins/NAME_OF_ROLE --handler index.handler --region us-east-1 --zip-file fileb://lambdafunction.zip --profile webadmins</span>
</code></pre></div>


<ul>
<li>Invoke the Lambda function</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws lambda invoke --function-name verifyfunction --region us-east-1 --invocation-type RequestResponse outputfile.txt --profile webadmins</span>
</code></pre></div>


<ul>
<li>Examine the output file. </li>
</ul>
<p>If you see files marked that <strong>webadmins/you-should-SEE-this-file--webadmins...</strong> then you have successfully verified that the webadmins can do their job. Also make sure the function is generating logs in CloudWatch logs.</p>
<ul>
<li><em>(Optional)</em> Test Lambda for alternate bucket prefix</li>
</ul>
<p>If time permits, repeat the previous steps in this task except create a new Lambda function such as <code>verifyfunction1</code> and set bucket prefix in the new Lambda function code to <code>appadmins</code>. What are the contents of the output file when the new Lambda function is invoked? Why is the result different than with the <code>webadmins</code> bucket prefix?</p>
<p>Congratulations!</p>
<h2 id="task-4-cleanup">Task 4 <small>Cleanup</small></h2>
<p><strong>You do not need to perform cleanup if Event Engine is being used.</strong> If Event Engine is not being used, to cleanup you need to delete the CloudFormation stack named <code>Perm-Bound-Adv</code> (this will also remove the Cloud9 stack if that was used in the workshop) and the IAM resources you created. Run these commands using the IAM user or role you used to do the <strong>BUILD</strong> phase.</p>
<p>Resources created in the <strong>VERIFY</strong> phase</p>
<ul>
<li>Detach policy from the role created in the <strong>VERIFY</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam detach-role-policy --role-name NAME_OF_VERIFY_ROLE --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/webadmins/NAME_OF_VERIFY_POLICY</span>
</code></pre></div>


<ul>
<li>Delete policy created in the <strong>VERIFY</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam delete-policy --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/webadmins/NAME_OF_VERIFY_POLICY</span>
</code></pre></div>


<ul>
<li>Delete role created in <strong>VERIFY</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam delete-role --role-name verifyrole</span>
</code></pre></div>


<ul>
<li>Delete the Lambda function created in <strong>VERIFY</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws lambda delete-function --function-name verifyfunction --region us-east-1</span>
</code></pre></div>


<p>Resources created in the <strong>BUILD</strong> phase</p>
<ul>
<li>Detach the two policies from the webadmins role created in the <strong>BUILD</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam detach-role-policy --role-name webadmins --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/webadminspermissionpolicy</span>
<span class="err">aws iam detach-role-policy --role-name webadmins --policy-arn arn:aws:iam::aws:policy/AWSLambdaReadOnlyAccess </span>
</code></pre></div>


<ul>
<li>Delete the webadmins role created in the <strong>BUILD</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam delete-role --role-name webadmins</span>
</code></pre></div>


<ul>
<li>Delete the permission policy created in the <strong>BUILD</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam delete-policy --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/webadminspermissionpolicy</span>
</code></pre></div>


<ul>
<li>Delete the permissions boundary created in the <strong>BUILD</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws iam delete-policy --policy-arn arn:aws:iam::&lt;ACCOUNT_ID&gt;:policy/webadminspermissionsboundary</span>
</code></pre></div>


<ul>
<li>Delete the CloudFormation stack created in the <strong>BUILD</strong> phase:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">aws cloudformation delete-stack --stack-name Perm-Bound-Adv --region us-east-1</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../build/" title="Build Phase" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Build Phase
              </div>
            </div>
          </a>
        
        
          <a href="../../contribute/" title="Contributing" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Contributing
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2019, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://awssecworkshops.com" target="_blank" rel="noopener" title="awssecworkshops.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M280.37 148.26L96 300.11V464a16 16 0 0016 16l112.06-.29a16 16 0 0015.92-16V368a16 16 0 0116-16h64a16 16 0 0116 16v95.64a16 16 0 0016 16.05L464 480a16 16 0 0016-16V300L295.67 148.26a12.19 12.19 0 00-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 00-12-12h-56a12 12 0 00-12 12v72.61L318.47 43a48 48 0 00-61 0L4.34 251.47a12 12 0 00-1.6 16.9l25.5 31A12 12 0 0045.15 301l235.22-193.74a12.19 12.19 0 0115.3 0L530.9 301a12 12 0 0016.9-1.6l25.5-31a12 12 0 00-1.7-16.93z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M466.5 83.7l-192-80a48.15 48.15 0 00-36.9 0l-192 80C27.7 91.1 16 108.6 16 128c0 198.5 114.5 335.7 221.5 380.3 11.8 4.9 25.1 4.9 36.9 0C360.1 472.6 496 349.3 496 128c0-19.4-11.7-36.9-29.5-44.3zM256.1 446.3l-.1-381 175.9 73.3c-3.3 151.4-82.1 261.1-175.8 307.7z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/awssecurityinfo?lang=en" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://aws.amazon.com/blogs/security/" target="_blank" rel="noopener" title="aws.amazon.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M400 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zM112 416c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm157.533 0h-34.335c-6.011 0-11.051-4.636-11.442-10.634-5.214-80.05-69.243-143.92-149.123-149.123-5.997-.39-10.633-5.431-10.633-11.441v-34.335c0-6.535 5.468-11.777 11.994-11.425 110.546 5.974 198.997 94.536 204.964 204.964.352 6.526-4.89 11.994-11.425 11.994zm103.027 0h-34.334c-6.161 0-11.175-4.882-11.427-11.038-5.598-136.535-115.204-246.161-251.76-251.76C68.882 152.949 64 147.935 64 141.774V107.44c0-6.454 5.338-11.664 11.787-11.432 167.83 6.025 302.21 141.191 308.205 308.205.232 6.449-4.978 11.787-11.432 11.787z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>